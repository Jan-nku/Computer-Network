IP的移动性管理
1）下载会不会中断？为什么？
A下载不会中断，因为集线器会将收到的数据包广播给每一个结点，因此当用户从一个AP移动到另一个AP时，依旧可以收到数据包，且TCP
连接的四元组未发生变化，下载自然不会中断。

B下载会发生短暂中断，但很快恢复。当结点从AP1移动到AP2时，因为交换机会记住IP、端口转发信息，因此当发送的数据包到达交换机时，
交换机会将数据包转发给AP1，而用户此时已经不在AP1，自然接收不到数据包，等到客户端的保活计时器超时，客户端会主动给服务器发送
消息报文，这时新的IP、端口转发信息会被交换机学习并覆盖旧的记录，因为TCP的四元组未发生变化，当服务器端新的数据包到来时，交换机
就可以将数据包正确转发给AP2下的用户。、

C下载会发生中断，因为AP1和AP2位于不同的路由器下，不是同一个物理网络，当用户从AP1移动到AP2时，IP地址会发生变化，TCP四元组变了，
这条连接自然也就不存在了。

这也就引发了IP的移动性管理问题，FTP使用的传输层协议是TCP，在不考虑替换传输层协议的前提下（比如基于UDP的QUIC协议，通过连接ID
来标记通信的两个端点，就不存在连接迁移的问题），可以采用以下两种方式。

2）间接路由和直接路由
法一：间接路由
每一个移动结点都有永久地址和转交地址，当移动结点移动到新的外部网络时，移动结点需要向新外部代理报道，新外部代理再向家乡代理报告，
家乡代理更新移动节点的转交地址，这样外部代理知道了移动结点的信息，家乡代理知道了移动节点的位置。

通信过程如下：
1.通信节点利用移动节点的永久地址封装数据包
2.家乡代理接收数据包，将其转发给外部代理
3.外部代理接收数据包，将其转发给移动节点（外部代理的功能也可以嵌入移动节点之中）
4.移动节点的响应包直接转发给通信者
也被称为三角路由，缺点是效率低，尤其是通信节点和移动节点在同一网络中时。
好处是外部代理的改变对通信结点是透明的，可以继续维持原来的连接。

法二：直接路由
通信过程如下：
1.通信节点利用移动节点的永久地址封装数据包，家乡代理接收并返回移动节点的外部代理地址信息
2.通信节点向外部代理转发数据包
3.外部代理接收数据包，转发给移动结点
4.移动结点的响应直接转发给通信节点
优点是克服三角路由问题，效率提高。
缺点是对通信节点不透明，通信节点必须从家乡代理得到转交地址，当移动节点移动到另一个外部网络时，通信节点第一次从家乡代理拿到的那个
外部代理位置也就失效了。

这里涉及到一个锚外部代理的概念。锚外部代理指的是通信者第一次从家乡代理拿到的那个外部代理。也就是说，在移动节点切换外部代理后，
锚外部代理会记录新的外部代理的位置，此时通信者代理只需要找到锚外部代理，然后由锚外部代理去联系新的外部代理即可。
如果外部代理反复变化，依然只需要更新锚外部代理中的记录即可。这么做的一个假设是从物理层面来说一个移动节点一下子不可能跑那么远，
不然锚外部代理也就退化为了家乡代理。一般来说，新旧外部代理是会比较近的，所以由锚外部代理转发并不会消耗太多的时间。


----------------------------------------------------------------------------------------------------------------------------------
参考博客：https://blog.csdn.net/qq_40714949/article/details/121691845


