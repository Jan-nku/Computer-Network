小组成员：许健、金新阳、陈都、吴佳润、巴瀛

-----------------------------------------UDP实现NAT穿透-----------------------------------------

两个不同内网的主机如何实现通信？

法一：中间服务器转发主机间的数据，但是当用户数量达到一定数目时，
这种方法浪费带宽且会给服务器带来很大压力，因此不可以

法二：服务器只充当介绍人，不转发主机间的数据，这涉及“UDP打孔技术”

1.完全锥形NAT
处于不同内网的主机A和主机B，各自先连接服务器，从而在各自的NAT设备上打了一个“孔”，服务器收到主机A和主机B的连接后，知道A和B的
公网地址和NAT分配给它们的端口号，然后将这些NAT地址和端口号信息告诉A和B，由于完全锥形NAT的特点，A和B给服务器所打开的“孔”，也可以
给别的任何主机使用，因此A和B可连接对方的公网地址和端口直接进行通信。

2.受限锥形NAT
A和B先连接服务器，服务器发送A和B的地址和端口信息给A和B，但是由于受限锥形NAT的特点(IP地址限制)，他们所打开的“孔”，只能与服务器通信，
因此要使得他们可以直接通信，解决办法如下：
A发送一个UDP信息到主机B的公网地址上，这时主机A向主机B的公网IP发送的消息导致NAT A打开一个处于主机A和主机B之间的会话，NAT B会将
这个信息丢弃(因为这样的信息是不请自来的，为了安全，大多数NAT都会执行丢弃动作)，A需要通过服务器C中转发送一个邀请信息给主机B，请
求主机B也给主机A发送一个UDP消息到主机A的公网地址，这样NAT B也打开了一个处于主机B与主机A的会话。一旦这个新的UDP会话各自向对方打
开，主机A和主机B之间才可以直接通信。

3.端口受限锥形NAT
受限锥形NAT的进一步受限版，增加端口限制。除了主动连接的主机(IP，port1)可以通讯，其他的(IP，port2)都不可以与之通讯，安全性更高。

4.对称形NAT
对于不同的外网主机地址会分配不同的端口号，进行UDP打孔比较困难，新方法的UDP打洞基于端口预测和限制TTL的值，但不保证成功。



-----------------------------------------NAT介绍，理解NAT穿透分类-----------------------------------------
P2P需要两个节点之间直接互相通信，而两个节点多数情况都位于防火墙内和内部局域网
内，从内往外访问很容易，但反过来却无法直接进行，这就涉及到NAT穿透技术。因为UDP
穿透简单，所以多数P2P的实现都是以UDP协议来实现的，UDP穿透包含以下几种NAT：
NAPT(网络地址端口转换)
- 锥形NAT
	- 完全锥形NAT
	- 受限锥形NAT
	- 端口受限锥形NAT
- 对称形NAT

1.全锥形NAT
全锥形NAT的IP、端口都不受限。只要客户端由内到外打通一个洞之后(NatIP:NatPort
->A:P1)，其他IP的主机(B)或端口(A:P2)都可以使用这个洞发送数据到客户端。映射
关系为：Client->NatIP:NatPort->Any，即任何外部主机都可通过NatIP:NatPort发送数
据到Client上。

2.受限锥形NAT
受限锥形NAT的IP受限，端口不受限。当客户端由内到外打通一个洞之后(NatIP:NatPort
->A:P1)，A机器可以使用它的其它端口(P2)主动连接客户端，但B机器则不被允许。映射
关系为：Client->NatIP:NatPort->A，即只有来自A的数据包才能通过NatIP:NatPort
发送到 Client上。

3.端口受限锥型NAT
端口受限锥型NAT的IP、端口都受限。返回的数据只接受曾经打洞成功的对象(A:P1)，由
A:P2、B:P1发起的数据将不被NatIP:NatPort接收。映射关系为：Client->NatIP:NatPort-
>A:P1，即只有来自A:P1的数据才可通过NatIP:NatPort发送到Client上。

4.对称型NAT
对称型NAT具有端口受限锥型的受限特性。但更重要的是，他对每个外部主机或端口的
会话都会映射为不同的端口(洞)。只有来自相同的内部地址(IP:PORT)并且发送到相同
外部地址(X:x)的请求，在NAT上才映射为相同的外网端口，即相同的映射。一个外部
地址(X:x)对应一个NAT上的映射，每个映射仅接收来自他绑定的外部地址的数据。关
键点在到不同的目的地(目的 IP: 目的端口)分配不同的映射地址(IP:Port)
根据四元组创建NAT映射，四元组中的任何一项发生变化均导致NAT映射的更换。
此形状双方一对一映射，因此被称之为对称NAT。